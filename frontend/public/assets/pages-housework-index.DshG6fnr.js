import{c as t,w as s,a as e,b as a,h as l,d as i,v as o,n as d,i as n,o as c,e as r,f as u,g as f,j as m,t as _,p as h,S as p,x as k,l as g,F as y,m as D,u as T,q as C,I as w,y as b,z as x}from"./index-Cg44Emc2.js";import{_ as M,s as U,a as v}from"./_plugin-vue_export-helper.BNHJzMf4.js";const F=M({data:()=>({userPoints:0,currentFilter:"all",tasks:[],filteredTasks:[],showModal:!1,isEdit:!1,editingTaskId:null,listHeight:"600rpx",formData:{title:"",description:"",assigned_to:"",due_date:"",points:10},taskIcons:{"æ´—ç¢—":"ğŸ½ï¸","æ‹–åœ°":"ğŸ§¹","æ´—è¡£æœ":"ğŸ‘”","åšé¥­":"ğŸ³","æ‰“æ‰«":"ğŸ§½","æ•´ç†":"ğŸ“¦","å€’åƒåœ¾":"ğŸ—‘ï¸","æµ‡èŠ±":"ğŸŒ¸"}}),computed:{allCount(){return this.tasks.length},pendingCount(){return this.tasks.filter(t=>"pending"===t.status).length},completedCount(){return this.tasks.filter(t=>"completed"===t.status).length}},onLoad(){this.initPage()},onShow(){this.loadUserPoints(),this.loadTasks()},methods:{initPage(){if(!U.getUser())return e({title:"è¯·å…ˆç™»å½•",icon:"none",duration:2e3}),void setTimeout(()=>{d({url:"/pages/login/index"})},2e3);this.calculateListHeight()},calculateListHeight(){const t=o().windowHeight-120-100-100;this.listHeight=`${t}rpx`},async loadUserPoints(){try{const t=U.getUser();if(!t)return;const s=await v.getPoints(t.user_id);s.success&&(this.userPoints=s.data.points||0,U.updatePoints(this.userPoints))}catch(t){console.error("åŠ è½½æƒ…åŠ›å€¼å¤±è´¥:",t)}},async loadTasks(){try{const t=U.getUser();if(!t)return;a({title:"åŠ è½½ä¸­...",mask:!0});const s=await v.getTasks(t.user_id,"","housework");s.success&&(this.tasks=s.data||[],this.filterTasks())}catch(t){console.error("åŠ è½½ä»»åŠ¡å¤±è´¥:",t),e({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}finally{l()}},setFilter(t){this.currentFilter=t,this.filterTasks()},filterTasks(){"all"===this.currentFilter?this.filteredTasks=this.tasks:this.filteredTasks=this.tasks.filter(t=>t.status===this.currentFilter)},getTaskIcon(t){for(const s in this.taskIcons)if(t.includes(s))return this.taskIcons[s];return"ğŸ§¹"},formatDate(t){if(!t)return"æœªè®¾ç½®";const s=new Date(t);return`${String(s.getMonth()+1).padStart(2,"0")}æœˆ${String(s.getDate()).padStart(2,"0")}æ—¥`},async completeTask(t){try{const s=U.getUser();if(!s)return;i({title:"ç¡®è®¤å®Œæˆ",content:`å®Œæˆã€${t.title}ã€‘å¯è·å¾—${t.points}ç‚¹æƒ…åŠ›`,success:async i=>{if(i.confirm){a({title:"å¤„ç†ä¸­...",mask:!0});try{(await v.completeTask(s.user_id,t.id)).success&&(e({title:`è·å¾—${t.points}ç‚¹æƒ…åŠ›`,icon:"success",duration:2e3}),this.loadUserPoints(),this.loadTasks())}catch(o){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",o)}finally{l()}}}})}catch(s){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",s)}},editTask(t){this.isEdit=!0,this.editingTaskId=t.id,this.formData={title:t.title,description:t.description||"",assigned_to:t.assigned_to||"",due_date:t.due_date?t.due_date.split(" ")[0]:"",points:t.points||10},this.showModal=!0},deleteTask(t){i({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ã€${t.title}ã€‘å—ï¼Ÿ`,confirmColor:"#ff4444",success:async s=>{if(s.confirm)try{const s=U.getUser();if(!s)return;a({title:"åˆ é™¤ä¸­...",mask:!0});(await v.deleteTask(t.id,s.user_id)).success&&(e({title:"åˆ é™¤æˆåŠŸ",icon:"success",duration:2e3}),this.loadTasks())}catch(i){console.error("åˆ é™¤ä»»åŠ¡å¤±è´¥:",i)}finally{l()}}})},showAddModal(){this.isEdit=!1,this.editingTaskId=null,this.formData={title:"",description:"",assigned_to:"",due_date:"",points:10},this.showModal=!0},closeModal(){this.showModal=!1},onDateChange(t){this.formData.due_date=t.detail.value},async handleSubmit(){if(this.formData.title.trim())try{const t=U.getUser();if(!t)return;if(a({title:this.isEdit?"ä¿å­˜ä¸­...":"åˆ›å»ºä¸­...",mask:!0}),this.isEdit){const s={user_id:t.user_id,title:this.formData.title.trim(),description:this.formData.description.trim(),assigned_to:this.formData.assigned_to.trim(),due_date:this.formData.due_date?`${this.formData.due_date} 23:59:59`:null};(await v.updateTask(this.editingTaskId,s)).success&&(e({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:2e3}),this.closeModal(),this.loadTasks())}else{const s={user_id:t.user_id,title:this.formData.title.trim(),description:this.formData.description.trim(),category:"housework",assigned_to:this.formData.assigned_to.trim(),points:parseInt(this.formData.points)||10,due_date:this.formData.due_date?`${this.formData.due_date} 23:59:59`:null};(await v.createTask(s)).success&&(e({title:"åˆ›å»ºæˆåŠŸ",icon:"success",duration:2e3}),this.closeModal(),this.loadTasks())}}catch(t){console.error("æ“ä½œå¤±è´¥:",t)}finally{l()}else e({title:"è¯·è¾“å…¥ä»»åŠ¡åç§°",icon:"none",duration:2e3})}}},[["render",function(e,a,l,i,o,d){const M=f,U=n,v=T,F=p,I=w,V=b,P=x;return c(),t(U,{class:"housework-container"},{default:s(()=>[r(U,{class:"header-section"},{default:s(()=>[r(U,{class:"header-title"},{default:s(()=>[r(M,{class:"title-icon"},{default:s(()=>[m("ğŸ§¹")]),_:1}),r(M,{class:"title-text"},{default:s(()=>[m("å®¶åŠ¡å®‰æ’")]),_:1})]),_:1}),r(U,{class:"points-badge"},{default:s(()=>[r(M,{class:"points-icon"},{default:s(()=>[m("ğŸ’–")]),_:1}),r(M,{class:"points-text"},{default:s(()=>[m(_(o.userPoints),1)]),_:1})]),_:1})]),_:1}),r(U,{class:"filter-section"},{default:s(()=>[r(U,{class:"filter-tabs"},{default:s(()=>[r(U,{class:h(["filter-tab",{active:"all"===o.currentFilter}]),onClick:a[0]||(a[0]=t=>d.setFilter("all"))},{default:s(()=>[r(M,null,{default:s(()=>[m("å…¨éƒ¨("+_(d.allCount)+")",1)]),_:1})]),_:1},8,["class"]),r(U,{class:h(["filter-tab",{active:"pending"===o.currentFilter}]),onClick:a[1]||(a[1]=t=>d.setFilter("pending"))},{default:s(()=>[r(M,null,{default:s(()=>[m("å¾…å®Œæˆ("+_(d.pendingCount)+")",1)]),_:1})]),_:1},8,["class"]),r(U,{class:h(["filter-tab",{active:"completed"===o.currentFilter}]),onClick:a[2]||(a[2]=t=>d.setFilter("completed"))},{default:s(()=>[r(M,null,{default:s(()=>[m("å·²å®Œæˆ("+_(d.completedCount)+")",1)]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),r(F,{class:"housework-list","scroll-y":"",style:k({height:o.listHeight})},{default:s(()=>[0===o.filteredTasks.length?(c(),t(U,{key:0,class:"empty-state"},{default:s(()=>[r(M,{class:"empty-icon"},{default:s(()=>[m("ğŸ“­")]),_:1}),r(M,{class:"empty-text"},{default:s(()=>[m("æš‚æ— å®¶åŠ¡ä»»åŠ¡")]),_:1}),r(M,{class:"empty-hint"},{default:s(()=>[m("ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ æ–°ä»»åŠ¡")]),_:1})]),_:1})):u("",!0),(c(!0),g(y,null,D(o.filteredTasks,e=>(c(),t(U,{class:"housework-card",key:e.id},{default:s(()=>[r(U,{class:"card-header"},{default:s(()=>[r(U,{class:"task-info"},{default:s(()=>[r(M,{class:"task-icon"},{default:s(()=>[m(_(d.getTaskIcon(e.title)),1)]),_:2},1024),r(U,{class:"task-details"},{default:s(()=>[r(M,{class:"task-title"},{default:s(()=>[m(_(e.title),1)]),_:2},1024),e.assigned_to?(c(),t(M,{key:0,class:"task-assigned"},{default:s(()=>[m(" åˆ†é…ç»™ï¼š"+_(e.assigned_to),1)]),_:2},1024)):u("",!0)]),_:2},1024)]),_:2},1024),r(U,{class:h(["status-badge","completed"===e.status?"status-completed":"status-pending"])},{default:s(()=>[m(_("completed"===e.status?"å·²å®Œæˆ":"å¾…å®Œæˆ"),1)]),_:2},1032,["class"])]),_:2},1024),e.description?(c(),t(U,{key:0,class:"task-description"},{default:s(()=>[r(M,null,{default:s(()=>[m(_(e.description),1)]),_:2},1024)]),_:2},1024)):u("",!0),r(U,{class:"card-footer"},{default:s(()=>[r(U,{class:"task-meta"},{default:s(()=>[r(M,{class:"meta-icon"},{default:s(()=>[m("ğŸ’–")]),_:1}),r(M,{class:"meta-text"},{default:s(()=>[m("+"+_(e.points)+" æƒ…åŠ›",1)]),_:2},1024)]),_:2},1024),e.due_date?(c(),t(U,{key:0,class:"task-meta"},{default:s(()=>[r(M,{class:"meta-icon"},{default:s(()=>[m("â°")]),_:1}),r(M,{class:"meta-text"},{default:s(()=>[m(_(d.formatDate(e.due_date)),1)]),_:2},1024)]),_:2},1024)):u("",!0)]),_:2},1024),r(U,{class:"card-actions"},{default:s(()=>["pending"===e.status?(c(),t(v,{key:0,class:"btn-complete",onClick:t=>d.completeTask(e)},{default:s(()=>[m(" å®Œæˆä»»åŠ¡ ")]),_:2},1032,["onClick"])):u("",!0),r(v,{class:"btn-edit",onClick:t=>d.editTask(e)},{default:s(()=>[m(" ç¼–è¾‘ ")]),_:2},1032,["onClick"]),r(v,{class:"btn-delete",onClick:t=>d.deleteTask(e)},{default:s(()=>[m(" åˆ é™¤ ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["style"]),r(U,{class:"add-btn",onClick:d.showAddModal},{default:s(()=>[r(M,{class:"add-icon"},{default:s(()=>[m("+")]),_:1})]),_:1},8,["onClick"]),o.showModal?(c(),t(U,{key:0,class:"modal-overlay",onClick:d.closeModal},{default:s(()=>[r(U,{class:"modal-content",onClick:a[7]||(a[7]=C(()=>{},["stop"]))},{default:s(()=>[r(U,{class:"modal-header"},{default:s(()=>[r(M,{class:"modal-title"},{default:s(()=>[m(_(o.isEdit?"ç¼–è¾‘ä»»åŠ¡":"æ–°å»ºå®¶åŠ¡ä»»åŠ¡"),1)]),_:1}),r(M,{class:"modal-close",onClick:d.closeModal},{default:s(()=>[m("âœ•")]),_:1},8,["onClick"])]),_:1}),r(U,{class:"modal-body"},{default:s(()=>[r(U,{class:"form-group"},{default:s(()=>[r(M,{class:"form-label"},{default:s(()=>[m("ä»»åŠ¡åç§°")]),_:1}),r(I,{class:"form-input",modelValue:o.formData.title,"onUpdate:modelValue":a[3]||(a[3]=t=>o.formData.title=t),placeholder:"ä¾‹å¦‚ï¼šæ´—ç¢—ã€æ‹–åœ°ã€æ´—è¡£æœ",maxlength:"30"},null,8,["modelValue"])]),_:1}),r(U,{class:"form-group"},{default:s(()=>[r(M,{class:"form-label"},{default:s(()=>[m("ä»»åŠ¡æè¿°")]),_:1}),r(V,{class:"form-textarea",modelValue:o.formData.description,"onUpdate:modelValue":a[4]||(a[4]=t=>o.formData.description=t),placeholder:"è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹ï¼ˆå¯é€‰ï¼‰",maxlength:"200"},null,8,["modelValue"])]),_:1}),r(U,{class:"form-group"},{default:s(()=>[r(M,{class:"form-label"},{default:s(()=>[m("åˆ†é…ç»™")]),_:1}),r(I,{class:"form-input",modelValue:o.formData.assigned_to,"onUpdate:modelValue":a[5]||(a[5]=t=>o.formData.assigned_to=t),placeholder:"è¾“å…¥ä¼´ä¾£åç§°ï¼ˆå¯é€‰ï¼‰",maxlength:"20"},null,8,["modelValue"])]),_:1}),r(U,{class:"form-group"},{default:s(()=>[r(M,{class:"form-label"},{default:s(()=>[m("æˆªæ­¢æ—¥æœŸ")]),_:1}),r(P,{mode:"date",value:o.formData.due_date,onChange:d.onDateChange},{default:s(()=>[r(U,{class:"picker-view"},{default:s(()=>[r(M,null,{default:s(()=>[m(_(o.formData.due_date||"é€‰æ‹©æ—¥æœŸ"),1)]),_:1}),r(M,{class:"picker-arrow"},{default:s(()=>[m("â–¼")]),_:1})]),_:1})]),_:1},8,["value","onChange"])]),_:1}),r(U,{class:"form-group"},{default:s(()=>[r(M,{class:"form-label"},{default:s(()=>[m("å¥–åŠ±æƒ…åŠ›")]),_:1}),r(I,{class:"form-input",modelValue:o.formData.points,"onUpdate:modelValue":a[6]||(a[6]=t=>o.formData.points=t),type:"number",placeholder:"é»˜è®¤10ç‚¹"},null,8,["modelValue"])]),_:1})]),_:1}),r(U,{class:"modal-footer"},{default:s(()=>[r(v,{class:"btn-cancel",onClick:d.closeModal},{default:s(()=>[m("å–æ¶ˆ")]),_:1},8,["onClick"]),r(v,{class:"btn-confirm",onClick:d.handleSubmit},{default:s(()=>[m(_(o.isEdit?"ä¿å­˜":"åˆ›å»º"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):u("",!0)]),_:1})}],["__scopeId","data-v-d8e82637"]]);export{F as default};
