import{c as e,w as t,a,b as s,h as l,d as n,v as o,n as i,i as r,o as c,e as d,f as u,g as h,j as f,t as k,l as g,F as m,m as _,p,S as y,x as w,q as T,I as C,y as D,z as M,u as S}from"./index-Cg44Emc2.js";import{_ as b,s as v,a as x}from"./_plugin-vue_export-helper.BNHJzMf4.js";const $=b({data:()=>({userPoints:0,currentYear:(new Date).getFullYear(),currentMonth:(new Date).getMonth()+1,selectedDate:new Date,weekdays:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],calendarDays:[],tasks:[],filteredTasks:[],showModal:!1,tasksListHeight:"500rpx",newTask:{title:"",description:"",category:"general",time:"",points:10},categories:[{value:"general",label:"æ™®é€šä»»åŠ¡"},{value:"housework",label:"å®¶åŠ¡"},{value:"date",label:"çº¦ä¼š"},{value:"study",label:"å­¦ä¹ "},{value:"exercise",label:"è¿åŠ¨"}],selectedCategory:{value:"general",label:"æ™®é€šä»»åŠ¡"}}),computed:{selectedDateStr(){const e=this.selectedDate;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}},onLoad(){this.initPage()},onShow(){this.loadUserPoints(),this.loadTasks()},methods:{initPage(){if(!v.getUser())return a({title:"è¯·å…ˆç™»å½•",icon:"none",duration:2e3}),void setTimeout(()=>{i({url:"/pages/login/index"})},2e3);this.calculateTasksListHeight(),this.generateCalendar(),this.loadUserPoints(),this.loadTasks()},calculateTasksListHeight(){const e=o().windowHeight-120-600-80-100;this.tasksListHeight=`${e}rpx`},async loadUserPoints(){try{const e=v.getUser();if(!e)return;const t=await x.getPoints(e.user_id);t.success&&(this.userPoints=t.data.points||0,v.updatePoints(this.userPoints))}catch(e){console.error("åŠ è½½æƒ…åŠ›å€¼å¤±è´¥:",e)}},async loadTasks(){try{const e=v.getUser();if(!e)return;const t=await x.getTasks(e.user_id);t.success&&(this.tasks=t.data||[],this.filterTasksByDate(),this.generateCalendar())}catch(e){console.error("åŠ è½½ä»»åŠ¡å¤±è´¥:",e)}},generateCalendar(){const e=this.currentYear,t=this.currentMonth,a=new Date(e,t-1,1),s=new Date(e,t,0).getDate(),l=a.getDay(),n=[],o=new Date(e,t-1,0).getDate();for(let c=l-1;c>=0;c--)n.push({day:o-c,isCurrentMonth:!1,date:new Date(e,t-2,o-c)});const i=new Date;for(let c=1;c<=s;c++){const a=new Date(e,t-1,c),s=this.formatDateStr(a),l=this.tasks.some(e=>{if(!e.due_date)return!1;const t=new Date(e.due_date);return this.formatDateStr(t)===s});n.push({day:c,isCurrentMonth:!0,isToday:this.isSameDay(a,i),isSelected:this.isSameDay(a,this.selectedDate),hasTask:l,date:a})}const r=42-n.length;for(let c=1;c<=r;c++)n.push({day:c,isCurrentMonth:!1,date:new Date(e,t,c)});this.calendarDays=n},prevMonth(){1===this.currentMonth?(this.currentYear--,this.currentMonth=12):this.currentMonth--,this.generateCalendar()},nextMonth(){12===this.currentMonth?(this.currentYear++,this.currentMonth=1):this.currentMonth++,this.generateCalendar()},selectDate(e){e.isCurrentMonth&&(this.selectedDate=e.date,this.generateCalendar(),this.filterTasksByDate())},filterTasksByDate(){const e=this.selectedDateStr;this.filteredTasks=this.tasks.filter(t=>{if(!t.due_date)return!1;const a=new Date(t.due_date);return this.formatDateStr(a)===e})},formatDateStr:e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,isSameDay(e,t){return this.formatDateStr(e)===this.formatDateStr(t)},formatTime(e){if(!e)return"æœªè®¾ç½®";const t=new Date(e);return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},getCategoryIcon:e=>({general:"ðŸ“",housework:"ðŸ§¹",date:"ðŸ’‘",study:"ðŸ“š",exercise:"ðŸƒ"}[e]||"ðŸ“"),viewTaskDetail(e){n({title:e.title,content:e.description||"æš‚æ— æè¿°",confirmText:"pending"===e.status?"å®Œæˆä»»åŠ¡":"ç¡®å®š",showCancel:"pending"===e.status,success:t=>{t.confirm&&"pending"===e.status&&this.completeTask(e)}})},async completeTask(e){try{const t=v.getUser();if(!t)return;s({title:"å¤„ç†ä¸­...",mask:!0});(await x.completeTask(t.user_id,e.id)).success&&(a({title:`èŽ·å¾—${e.points}ç‚¹æƒ…åŠ›`,icon:"success",duration:2e3}),this.loadUserPoints(),this.loadTasks())}catch(t){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",t)}finally{l()}},showAddTask(){this.showModal=!0,this.newTask={title:"",description:"",category:"general",time:"",points:10},this.selectedCategory=this.categories[0]},closeModal(){this.showModal=!1},onCategoryChange(e){const t=e.detail.value;this.selectedCategory=this.categories[t],this.newTask.category=this.selectedCategory.value},onTimeChange(e){this.newTask.time=e.detail.value},async handleCreateTask(){if(this.newTask.title.trim())try{const e=v.getUser();if(!e)return;s({title:"åˆ›å»ºä¸­...",mask:!0});const t=this.newTask.time?`${this.selectedDateStr} ${this.newTask.time}:00`:`${this.selectedDateStr} 23:59:59`,l={user_id:e.user_id,title:this.newTask.title.trim(),description:this.newTask.description.trim(),category:this.newTask.category,points:parseInt(this.newTask.points)||10,due_date:t};(await x.createTask(l)).success&&(a({title:"ä»»åŠ¡åˆ›å»ºæˆåŠŸ",icon:"success",duration:2e3}),this.closeModal(),this.loadTasks())}catch(e){console.error("åˆ›å»ºä»»åŠ¡å¤±è´¥:",e)}finally{l()}else a({title:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜",icon:"none",duration:2e3})}}},[["render",function(a,s,l,n,o,i){const b=h,v=r,x=y,$=C,P=D,U=M,V=S;return c(),e(v,{class:"schedule-container"},{default:t(()=>[d(v,{class:"header-section"},{default:t(()=>[d(v,{class:"header-title"},{default:t(()=>[d(b,{class:"title-icon"},{default:t(()=>[f("ðŸ“…")]),_:1}),d(b,{class:"title-text"},{default:t(()=>[f("æ—¶é—´å®‰æŽ’")]),_:1})]),_:1}),d(v,{class:"points-badge"},{default:t(()=>[d(b,{class:"points-icon"},{default:t(()=>[f("ðŸ’–")]),_:1}),d(b,{class:"points-text"},{default:t(()=>[f(k(o.userPoints),1)]),_:1})]),_:1})]),_:1}),d(v,{class:"calendar-section"},{default:t(()=>[d(v,{class:"calendar-header"},{default:t(()=>[d(b,{class:"month-btn",onClick:i.prevMonth},{default:t(()=>[f("â—€")]),_:1},8,["onClick"]),d(b,{class:"current-month"},{default:t(()=>[f(k(o.currentYear)+"å¹´"+k(o.currentMonth)+"æœˆ",1)]),_:1}),d(b,{class:"month-btn",onClick:i.nextMonth},{default:t(()=>[f("â–¶")]),_:1},8,["onClick"])]),_:1}),d(v,{class:"weekdays"},{default:t(()=>[(c(!0),g(m,null,_(o.weekdays,(a,s)=>(c(),e(b,{class:"weekday",key:s},{default:t(()=>[f(k(a),1)]),_:2},1024))),128))]),_:1}),d(v,{class:"calendar-grid"},{default:t(()=>[(c(!0),g(m,null,_(o.calendarDays,(a,s)=>(c(),e(v,{class:p(["calendar-day",{"other-month":!a.isCurrentMonth,today:a.isToday,selected:a.isSelected,"has-task":a.hasTask}]),key:s,onClick:e=>i.selectDate(a)},{default:t(()=>[d(b,{class:"day-number"},{default:t(()=>[f(k(a.day),1)]),_:2},1024),a.hasTask?(c(),e(v,{key:0,class:"task-dot"})):u("",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),d(v,{class:"tasks-section"},{default:t(()=>[d(v,{class:"section-header"},{default:t(()=>[d(b,{class:"section-title"},{default:t(()=>[f("ðŸ“‹ "+k(i.selectedDateStr)+" çš„ä»»åŠ¡",1)]),_:1}),d(b,{class:"task-count"},{default:t(()=>[f("("+k(o.filteredTasks.length)+")",1)]),_:1})]),_:1}),d(x,{class:"tasks-list","scroll-y":"",style:w({height:o.tasksListHeight})},{default:t(()=>[0===o.filteredTasks.length?(c(),e(v,{key:0,class:"empty-state"},{default:t(()=>[d(b,{class:"empty-icon"},{default:t(()=>[f("ðŸ“­")]),_:1}),d(b,{class:"empty-text"},{default:t(()=>[f("è¯¥æ—¥æœŸæš‚æ— ä»»åŠ¡")]),_:1})]),_:1})):u("",!0),(c(!0),g(m,null,_(o.filteredTasks,a=>(c(),e(v,{class:"task-card",key:a.id,onClick:e=>i.viewTaskDetail(a)},{default:t(()=>[d(v,{class:"task-header"},{default:t(()=>[d(v,{class:"task-info"},{default:t(()=>[d(b,{class:"task-category-icon"},{default:t(()=>[f(k(i.getCategoryIcon(a.category)),1)]),_:2},1024),d(b,{class:"task-title"},{default:t(()=>[f(k(a.title),1)]),_:2},1024)]),_:2},1024),d(v,{class:p(["task-status-badge","completed"===a.status?"status-completed":"status-pending"])},{default:t(()=>[f(k("completed"===a.status?"å·²å®Œæˆ":"å¾…å®Œæˆ"),1)]),_:2},1032,["class"])]),_:2},1024),a.description?(c(),e(v,{key:0,class:"task-description"},{default:t(()=>[d(b,null,{default:t(()=>[f(k(a.description),1)]),_:2},1024)]),_:2},1024)):u("",!0),d(v,{class:"task-footer"},{default:t(()=>[d(v,{class:"task-meta"},{default:t(()=>[d(b,{class:"meta-icon"},{default:t(()=>[f("â°")]),_:1}),d(b,{class:"meta-text"},{default:t(()=>[f(k(i.formatTime(a.due_date)),1)]),_:2},1024)]),_:2},1024),d(v,{class:"task-meta"},{default:t(()=>[d(b,{class:"meta-icon"},{default:t(()=>[f("ðŸ’–")]),_:1}),d(b,{class:"meta-text"},{default:t(()=>[f("+"+k(a.points),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},8,["style"])]),_:1}),d(v,{class:"add-btn",onClick:i.showAddTask},{default:t(()=>[d(b,{class:"add-icon"},{default:t(()=>[f("+")]),_:1})]),_:1},8,["onClick"]),o.showModal?(c(),e(v,{key:0,class:"modal-overlay",onClick:i.closeModal},{default:t(()=>[d(v,{class:"modal-content",onClick:s[3]||(s[3]=T(()=>{},["stop"]))},{default:t(()=>[d(v,{class:"modal-header"},{default:t(()=>[d(b,{class:"modal-title"},{default:t(()=>[f("æ–°å»ºä»»åŠ¡")]),_:1}),d(b,{class:"modal-close",onClick:i.closeModal},{default:t(()=>[f("âœ•")]),_:1},8,["onClick"])]),_:1}),d(v,{class:"modal-body"},{default:t(()=>[d(v,{class:"form-group"},{default:t(()=>[d(b,{class:"form-label"},{default:t(()=>[f("ä»»åŠ¡æ ‡é¢˜")]),_:1}),d($,{class:"form-input",modelValue:o.newTask.title,"onUpdate:modelValue":s[0]||(s[0]=e=>o.newTask.title=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜",maxlength:"50"},null,8,["modelValue"])]),_:1}),d(v,{class:"form-group"},{default:t(()=>[d(b,{class:"form-label"},{default:t(()=>[f("ä»»åŠ¡æè¿°")]),_:1}),d(P,{class:"form-textarea",modelValue:o.newTask.description,"onUpdate:modelValue":s[1]||(s[1]=e=>o.newTask.description=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰",maxlength:"200"},null,8,["modelValue"])]),_:1}),d(v,{class:"form-group"},{default:t(()=>[d(b,{class:"form-label"},{default:t(()=>[f("ä»»åŠ¡ç±»åž‹")]),_:1}),d(U,{mode:"selector",range:o.categories,"range-key":"label",onChange:i.onCategoryChange},{default:t(()=>[d(v,{class:"picker-view"},{default:t(()=>[d(b,null,{default:t(()=>[f(k(o.selectedCategory.label),1)]),_:1}),d(b,{class:"picker-arrow"},{default:t(()=>[f("â–¼")]),_:1})]),_:1})]),_:1},8,["range","onChange"])]),_:1}),d(v,{class:"form-group"},{default:t(()=>[d(b,{class:"form-label"},{default:t(()=>[f("æˆªæ­¢æ—¶é—´")]),_:1}),d(U,{mode:"time",value:o.newTask.time,onChange:i.onTimeChange},{default:t(()=>[d(v,{class:"picker-view"},{default:t(()=>[d(b,null,{default:t(()=>[f(k(o.newTask.time||"é€‰æ‹©æ—¶é—´"),1)]),_:1}),d(b,{class:"picker-arrow"},{default:t(()=>[f("â–¼")]),_:1})]),_:1})]),_:1},8,["value","onChange"])]),_:1}),d(v,{class:"form-group"},{default:t(()=>[d(b,{class:"form-label"},{default:t(()=>[f("å¥–åŠ±æƒ…åŠ›")]),_:1}),d($,{class:"form-input",modelValue:o.newTask.points,"onUpdate:modelValue":s[2]||(s[2]=e=>o.newTask.points=e),type:"number",placeholder:"é»˜è®¤10"},null,8,["modelValue"])]),_:1})]),_:1}),d(v,{class:"modal-footer"},{default:t(()=>[d(V,{class:"btn-cancel",onClick:i.closeModal},{default:t(()=>[f("å–æ¶ˆ")]),_:1},8,["onClick"]),d(V,{class:"btn-confirm",onClick:i.handleCreateTask},{default:t(()=>[f("ç¡®è®¤")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):u("",!0)]),_:1})}],["__scopeId","data-v-9ef36230"]]);export{$ as default};
