import{c as t,w as s,b as l,a as e,h as a,d as c,v as o,n as i,i as n,o as u,e as d,f as r,g as f,j as _,t as k,k as h,l as m,F as p,m as g,p as y,S as F,x as C,u as b,q as w}from"./index-Cg44Emc2.js";import{_ as P,s as v,a as x}from"./_plugin-vue_export-helper.BNHJzMf4.js";const D=P({data:()=>({userPoints:0,fruits:[],showDetailModal:!1,selectedFruit:{},listHeight:"400rpx",fruitPositions:["pos-top-left","pos-top-right","pos-middle-left","pos-middle-right","pos-bottom-center"]}),computed:{totalCount(){return this.fruits.length},unlockedCount(){return this.fruits.filter(t=>t.unlocked).length},completionRate(){return 0===this.totalCount?0:Math.round(this.unlockedCount/this.totalCount*100)}},onLoad(){this.initPage()},onShow(){this.loadData()},methods:{initPage(){if(!v.getUser())return e({title:"è¯·å…ˆç™»å½•",icon:"none",duration:2e3}),void setTimeout(()=>{i({url:"/pages/login/index"})},2e3);this.calculateListHeight()},calculateListHeight(){const t=o().windowHeight-120-600-120-80-100;this.listHeight=`${t}rpx`},async loadData(){try{const t=v.getUser();if(!t)return;l({title:"åŠ è½½ä¸­...",mask:!0});const[s,e]=await Promise.all([x.getPoints(t.user_id),x.getFruits(t.user_id)]);s.success&&(this.userPoints=s.data.points||0,v.updatePoints(this.userPoints)),e.success&&(this.fruits=e.data||[])}catch(t){console.error("åŠ è½½æ•°æ®å¤±è´¥:",t),e({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}finally{a()}},getFruitPositionClass(t){return this.fruitPositions[t%this.fruitPositions.length]||"pos-middle-center"},handleFruitClick(t){this.selectedFruit=t,this.showDetailModal=!0},closeDetailModal(){this.showDetailModal=!1,this.selectedFruit={}},async unlockFruit(t){t.can_unlock?c({title:"ç¡®è®¤è§£é”",content:`ç¡®å®šè¦è§£é”ã€${t.name}ã€‘å—ï¼Ÿéœ€è¦${t.unlock_points}ç‚¹æƒ…åŠ›`,success:async s=>{s.confirm&&await this.performUnlock(t)}}):e({title:`è¿˜éœ€${t.unlock_points-this.userPoints}ç‚¹æƒ…åŠ›`,icon:"none",duration:2e3})},async unlockFruitFromModal(){await this.performUnlock(this.selectedFruit),this.closeDetailModal()},async performUnlock(t){try{const s=v.getUser();if(!s)return;l({title:"è§£é”ä¸­...",mask:!0});(await x.unlockFruit(t.id,s.user_id)).success&&(e({title:`æˆåŠŸè§£é”ã€${t.name}ã€‘`,icon:"success",duration:2e3}),this.loadData())}catch(s){console.error("è§£é”å¤±è´¥:",s),e({title:s.message||"è§£é”å¤±è´¥",icon:"none",duration:2e3})}finally{a()}}}},[["render",function(l,e,a,c,o,i){const P=f,v=n,x=h,D=b,M=F;return u(),t(v,{class:"tree-container"},{default:s(()=>[d(v,{class:"header-section"},{default:s(()=>[d(v,{class:"header-title"},{default:s(()=>[d(P,{class:"title-icon"},{default:s(()=>[_("ğŸŒ³")]),_:1}),d(P,{class:"title-text"},{default:s(()=>[_("å¤æƒ…æ ‘")]),_:1})]),_:1}),d(v,{class:"points-badge"},{default:s(()=>[d(P,{class:"points-icon"},{default:s(()=>[_("ğŸ’–")]),_:1}),d(P,{class:"points-text"},{default:s(()=>[_(k(o.userPoints),1)]),_:1})]),_:1})]),_:1}),d(v,{class:"tree-scene"},{default:s(()=>[d(x,{class:"tree-bg",src:"https://hpi-hub.tos-cn-beijing.volces.com/static/biology/tree-8378346_1280.png",mode:"aspectFit"}),d(v,{class:"fruits-container"},{default:s(()=>[(u(!0),m(p,null,g(o.fruits,(l,e)=>(u(),t(v,{class:y(["fruit-item",i.getFruitPositionClass(e)]),key:l.id,onClick:t=>i.handleFruitClick(l)},{default:s(()=>[d(v,{class:"fruit-wrapper"},{default:s(()=>[d(x,{class:y(["fruit-icon",{"fruit-unlocked":l.unlocked,"fruit-locked":!l.unlocked}]),src:l.icon,mode:"aspectFit"},null,8,["src","class"]),l.unlocked?r("",!0):(u(),t(v,{key:0,class:"lock-overlay"},{default:s(()=>[d(P,{class:"lock-icon"},{default:s(()=>[_("ğŸ”’")]),_:1})]),_:1})),l.unlocked?(u(),t(v,{key:1,class:"unlock-badge"},{default:s(()=>[d(P,{class:"unlock-text"},{default:s(()=>[_("âœ“")]),_:1})]),_:1})):r("",!0)]),_:2},1024),d(P,{class:"fruit-name"},{default:s(()=>[_(k(l.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),d(v,{class:"stats-section"},{default:s(()=>[d(v,{class:"stat-card"},{default:s(()=>[d(P,{class:"stat-icon"},{default:s(()=>[_("ğŸ¯")]),_:1}),d(v,{class:"stat-info"},{default:s(()=>[d(P,{class:"stat-label"},{default:s(()=>[_("å·²è§£é”")]),_:1}),d(P,{class:"stat-value"},{default:s(()=>[_(k(i.unlockedCount)+"/"+k(i.totalCount),1)]),_:1})]),_:1})]),_:1}),d(v,{class:"stat-card"},{default:s(()=>[d(P,{class:"stat-icon"},{default:s(()=>[_("â­")]),_:1}),d(v,{class:"stat-info"},{default:s(()=>[d(P,{class:"stat-label"},{default:s(()=>[_("å®Œæˆåº¦")]),_:1}),d(P,{class:"stat-value"},{default:s(()=>[_(k(i.completionRate)+"%",1)]),_:1})]),_:1})]),_:1})]),_:1}),d(M,{class:"fruits-list","scroll-y":"",style:C({height:o.listHeight})},{default:s(()=>[d(v,{class:"list-header"},{default:s(()=>[d(P,{class:"list-title"},{default:s(()=>[_("ğŸ æœå®å›¾é‰´")]),_:1})]),_:1}),(u(!0),m(p,null,g(o.fruits,l=>(u(),t(v,{class:y(["fruit-card",{"card-unlocked":l.unlocked,"card-locked":!l.unlocked}]),key:l.id},{default:s(()=>[d(v,{class:"card-left"},{default:s(()=>[d(x,{class:y(["card-icon",{"icon-gray":!l.unlocked}]),src:l.icon,mode:"aspectFit"},null,8,["src","class"])]),_:2},1024),d(v,{class:"card-center"},{default:s(()=>[d(v,{class:"card-name-row"},{default:s(()=>[d(P,{class:"card-name"},{default:s(()=>[_(k(l.name),1)]),_:2},1024),d(v,{class:y(["card-status",l.unlocked?"status-unlocked":"status-locked"])},{default:s(()=>[_(k(l.unlocked?"å·²è§£é”":"æœªè§£é”"),1)]),_:2},1032,["class"])]),_:2},1024),d(P,{class:"card-desc"},{default:s(()=>[_(k(l.description),1)]),_:2},1024),d(v,{class:"card-points"},{default:s(()=>[d(P,{class:"points-label"},{default:s(()=>[_("è§£é”æ¡ä»¶ï¼š")]),_:1}),d(P,{class:"points-value"},{default:s(()=>[_(k(l.unlock_points)+"ç‚¹æƒ…åŠ›",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),d(v,{class:"card-right"},{default:s(()=>[l.can_unlock?(u(),t(D,{key:0,class:"btn-unlock",onClick:t=>i.unlockFruit(l)},{default:s(()=>[_(" è§£é” ")]),_:2},1032,["onClick"])):l.unlocked?(u(),t(v,{key:1,class:"unlocked-mark"},{default:s(()=>[d(P,{class:"unlocked-icon"},{default:s(()=>[_("âœ“")]),_:1})]),_:1})):(u(),t(v,{key:2,class:"locked-hint"},{default:s(()=>[d(P,{class:"locked-text"},{default:s(()=>[_("è¿˜å·®"+k(l.unlock_points-o.userPoints)+"ç‚¹",1)]),_:2},1024)]),_:2},1024))]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},8,["style"]),o.showDetailModal?(u(),t(v,{key:0,class:"modal-overlay",onClick:i.closeDetailModal},{default:s(()=>[d(v,{class:"modal-content",onClick:e[0]||(e[0]=w(()=>{},["stop"]))},{default:s(()=>[d(v,{class:"modal-header"},{default:s(()=>[d(P,{class:"modal-title"},{default:s(()=>[_(k(o.selectedFruit.name),1)]),_:1}),d(P,{class:"modal-close",onClick:i.closeDetailModal},{default:s(()=>[_("âœ•")]),_:1},8,["onClick"])]),_:1}),d(v,{class:"modal-body"},{default:s(()=>[d(x,{class:"modal-icon",src:o.selectedFruit.icon,mode:"aspectFit"},null,8,["src"]),d(v,{class:"modal-info"},{default:s(()=>[d(v,{class:"info-row"},{default:s(()=>[d(P,{class:"info-label"},{default:s(()=>[_("çŠ¶æ€ï¼š")]),_:1}),d(P,{class:"info-value",style:C({color:o.selectedFruit.unlocked?"#4caf50":"#ff9800"})},{default:s(()=>[_(k(o.selectedFruit.unlocked?"å·²è§£é”":"æœªè§£é”"),1)]),_:1},8,["style"])]),_:1}),d(v,{class:"info-row"},{default:s(()=>[d(P,{class:"info-label"},{default:s(()=>[_("è§£é”æ¡ä»¶ï¼š")]),_:1}),d(P,{class:"info-value"},{default:s(()=>[_(k(o.selectedFruit.unlock_points)+"ç‚¹æƒ…åŠ›",1)]),_:1})]),_:1}),d(v,{class:"info-row"},{default:s(()=>[d(P,{class:"info-label"},{default:s(()=>[_("å½“å‰æƒ…åŠ›ï¼š")]),_:1}),d(P,{class:"info-value"},{default:s(()=>[_(k(o.userPoints)+"ç‚¹",1)]),_:1})]),_:1}),d(v,{class:"info-desc"},{default:s(()=>[d(P,{class:"desc-label"},{default:s(()=>[_("æè¿°ï¼š")]),_:1}),d(P,{class:"desc-text"},{default:s(()=>[_(k(o.selectedFruit.description),1)]),_:1})]),_:1})]),_:1})]),_:1}),d(v,{class:"modal-footer"},{default:s(()=>[o.selectedFruit.can_unlock?(u(),t(D,{key:0,class:"btn-modal-unlock",onClick:i.unlockFruitFromModal},{default:s(()=>[_(" ç«‹å³è§£é” ")]),_:1},8,["onClick"])):(u(),t(D,{key:1,class:"btn-modal-close",onClick:i.closeDetailModal},{default:s(()=>[_(k(o.selectedFruit.unlocked?"å·²è§£é”":"æƒ…åŠ›ä¸è¶³"),1)]),_:1},8,["onClick"]))]),_:1})]),_:1})]),_:1},8,["onClick"])):r("",!0)]),_:1})}],["__scopeId","data-v-345bc200"]]);export{D as default};
