import{c as t,w as a,a as e,b as s,h as l,d as i,v as o,n as d,i as c,o as r,e as n,f as u,g as f,j as _,t as m,p as h,S as g,x as k,l as p,F as y,m as C,u as T,q as b,I as D,y as w,z as v}from"./index-Cg44Emc2.js";import{_ as x,s as S,a as M}from"./_plugin-vue_export-helper.BNHJzMf4.js";const U=x({data:()=>({userPoints:0,currentFilter:"all",tasks:[],filteredTasks:[],taskStats:{total:0,completed:0,pending:0},showModal:!1,isEdit:!1,editingTaskId:null,listHeight:"600rpx",formData:{title:"",description:"",category:"general",assigned_to:"",due_date:"",points:10},categories:[{value:"general",label:"æ™®é€šä»»åŠ¡"},{value:"housework",label:"å®¶åŠ¡"},{value:"date",label:"çº¦ä¼š"},{value:"study",label:"å­¦ä¹ "},{value:"exercise",label:"è¿åŠ¨"}],selectedCategory:{value:"general",label:"æ™®é€šä»»åŠ¡"}}),onLoad(){this.initPage()},onShow(){this.loadUserPoints(),this.loadTasks(),this.loadTaskStats()},methods:{initPage(){if(!S.getUser())return e({title:"è¯·å…ˆç™»å½•",icon:"none",duration:2e3}),void setTimeout(()=>{d({url:"/pages/login/index"})},2e3);this.calculateListHeight()},calculateListHeight(){const t=o().windowHeight-120-140-100-100;this.listHeight=`${t}rpx`},async loadUserPoints(){try{const t=S.getUser();if(!t)return;const a=await M.getPoints(t.user_id);a.success&&(this.userPoints=a.data.points||0,S.updatePoints(this.userPoints))}catch(t){console.error("åŠ è½½æƒ…åŠ›å€¼å¤±è´¥:",t)}},async loadTasks(){try{const t=S.getUser();if(!t)return;s({title:"åŠ è½½ä¸­...",mask:!0});const a=await M.getTasks(t.user_id);a.success&&(this.tasks=a.data||[],this.filterTasks())}catch(t){console.error("åŠ è½½ä»»åŠ¡å¤±è´¥:",t),e({title:"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none",duration:2e3})}finally{l()}},async loadTaskStats(){try{const t=S.getUser();if(!t)return;const a=await M.getTaskStats(t.user_id);a.success&&(this.taskStats=a.data)}catch(t){console.error("åŠ è½½ä»»åŠ¡ç»Ÿè®¡å¤±è´¥:",t)}},setFilter(t){this.currentFilter=t,this.filterTasks()},filterTasks(){"all"===this.currentFilter?this.filteredTasks=this.tasks:this.filteredTasks=this.tasks.filter(t=>t.status===this.currentFilter)},getCategoryIcon:t=>({general:"ğŸ“",housework:"ğŸ§¹",date:"ğŸ’‘",study:"ğŸ“š",exercise:"ğŸƒ"}[t]||"ğŸ“"),getCategoryName:t=>({general:"æ™®é€š",housework:"å®¶åŠ¡",date:"çº¦ä¼š",study:"å­¦ä¹ ",exercise:"è¿åŠ¨"}[t]||"æ™®é€š"),formatDate(t){if(!t)return"æœªè®¾ç½®";const a=new Date(t);return`${String(a.getMonth()+1).padStart(2,"0")}æœˆ${String(a.getDate()).padStart(2,"0")}æ—¥`},async completeTask(t){try{const a=S.getUser();if(!a)return;i({title:"ç¡®è®¤å®Œæˆ",content:`å®Œæˆã€${t.title}ã€‘å¯è·å¾—${t.points}ç‚¹æƒ…åŠ›`,success:async i=>{if(i.confirm){s({title:"å¤„ç†ä¸­...",mask:!0});try{(await M.completeTask(a.user_id,t.id)).success&&(e({title:`è·å¾—${t.points}ç‚¹æƒ…åŠ›`,icon:"success",duration:2e3}),this.loadUserPoints(),this.loadTasks(),this.loadTaskStats())}catch(o){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",o)}finally{l()}}}})}catch(a){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",a)}},editTask(t){this.isEdit=!0,this.editingTaskId=t.id;const a=this.categories.find(a=>a.value===t.category);this.selectedCategory=a||this.categories[0],this.formData={title:t.title,description:t.description||"",category:t.category,assigned_to:t.assigned_to||"",due_date:t.due_date?t.due_date.split(" ")[0]:"",points:t.points||10},this.showModal=!0},deleteTask(t){i({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ã€${t.title}ã€‘å—ï¼Ÿ`,confirmColor:"#ff4444",success:async a=>{if(a.confirm)try{const a=S.getUser();if(!a)return;s({title:"åˆ é™¤ä¸­...",mask:!0});(await M.deleteTask(t.id,a.user_id)).success&&(e({title:"åˆ é™¤æˆåŠŸ",icon:"success",duration:2e3}),this.loadTasks(),this.loadTaskStats())}catch(i){console.error("åˆ é™¤ä»»åŠ¡å¤±è´¥:",i)}finally{l()}}})},showAddModal(){this.isEdit=!1,this.editingTaskId=null,this.selectedCategory=this.categories[0],this.formData={title:"",description:"",category:"general",assigned_to:"",due_date:"",points:10},this.showModal=!0},closeModal(){this.showModal=!1},onCategoryChange(t){const a=t.detail.value;this.selectedCategory=this.categories[a],this.formData.category=this.selectedCategory.value},onDateChange(t){this.formData.due_date=t.detail.value},async handleSubmit(){if(this.formData.title.trim())try{const t=S.getUser();if(!t)return;if(s({title:this.isEdit?"ä¿å­˜ä¸­...":"åˆ›å»ºä¸­...",mask:!0}),this.isEdit){const a={user_id:t.user_id,title:this.formData.title.trim(),description:this.formData.description.trim(),assigned_to:this.formData.assigned_to.trim(),due_date:this.formData.due_date?`${this.formData.due_date} 23:59:59`:null};(await M.updateTask(this.editingTaskId,a)).success&&(e({title:"ä¿å­˜æˆåŠŸ",icon:"success",duration:2e3}),this.closeModal(),this.loadTasks())}else{const a={user_id:t.user_id,title:this.formData.title.trim(),description:this.formData.description.trim(),category:this.formData.category,assigned_to:this.formData.assigned_to.trim(),points:parseInt(this.formData.points)||10,due_date:this.formData.due_date?`${this.formData.due_date} 23:59:59`:null};(await M.createTask(a)).success&&(e({title:"åˆ›å»ºæˆåŠŸ",icon:"success",duration:2e3}),this.closeModal(),this.loadTasks(),this.loadTaskStats())}}catch(t){console.error("æ“ä½œå¤±è´¥:",t)}finally{l()}else e({title:"è¯·è¾“å…¥ä»»åŠ¡åç§°",icon:"none",duration:2e3})}}},[["render",function(e,s,l,i,o,d){const x=f,S=c,M=T,U=g,F=D,V=w,P=v;return r(),t(S,{class:"task-container"},{default:a(()=>[n(S,{class:"header-section"},{default:a(()=>[n(S,{class:"header-title"},{default:a(()=>[n(x,{class:"title-icon"},{default:a(()=>[_("ğŸ“‹")]),_:1}),n(x,{class:"title-text"},{default:a(()=>[_("ä»»åŠ¡åˆ—è¡¨")]),_:1})]),_:1}),n(S,{class:"points-badge"},{default:a(()=>[n(x,{class:"points-icon"},{default:a(()=>[_("ğŸ’–")]),_:1}),n(x,{class:"points-text"},{default:a(()=>[_(m(o.userPoints),1)]),_:1})]),_:1})]),_:1}),n(S,{class:"stats-section"},{default:a(()=>[n(S,{class:"stat-card"},{default:a(()=>[n(x,{class:"stat-value"},{default:a(()=>[_(m(o.taskStats.total),1)]),_:1}),n(x,{class:"stat-label"},{default:a(()=>[_("æ€»ä»»åŠ¡")]),_:1})]),_:1}),n(S,{class:"stat-card"},{default:a(()=>[n(x,{class:"stat-value"},{default:a(()=>[_(m(o.taskStats.completed),1)]),_:1}),n(x,{class:"stat-label"},{default:a(()=>[_("å·²å®Œæˆ")]),_:1})]),_:1}),n(S,{class:"stat-card"},{default:a(()=>[n(x,{class:"stat-value"},{default:a(()=>[_(m(o.taskStats.pending),1)]),_:1}),n(x,{class:"stat-label"},{default:a(()=>[_("å¾…å®Œæˆ")]),_:1})]),_:1})]),_:1}),n(S,{class:"filter-section"},{default:a(()=>[n(S,{class:"filter-tabs"},{default:a(()=>[n(S,{class:h(["filter-tab",{active:"all"===o.currentFilter}]),onClick:s[0]||(s[0]=t=>d.setFilter("all"))},{default:a(()=>[n(x,null,{default:a(()=>[_("å…¨éƒ¨")]),_:1})]),_:1},8,["class"]),n(S,{class:h(["filter-tab",{active:"pending"===o.currentFilter}]),onClick:s[1]||(s[1]=t=>d.setFilter("pending"))},{default:a(()=>[n(x,null,{default:a(()=>[_("å¾…å®Œæˆ")]),_:1})]),_:1},8,["class"]),n(S,{class:h(["filter-tab",{active:"completed"===o.currentFilter}]),onClick:s[2]||(s[2]=t=>d.setFilter("completed"))},{default:a(()=>[n(x,null,{default:a(()=>[_("å·²å®Œæˆ")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),n(U,{class:"task-list","scroll-y":"",style:k({height:o.listHeight})},{default:a(()=>[0===o.filteredTasks.length?(r(),t(S,{key:0,class:"empty-state"},{default:a(()=>[n(x,{class:"empty-icon"},{default:a(()=>[_("ğŸ“­")]),_:1}),n(x,{class:"empty-text"},{default:a(()=>[_("æš‚æ— ä»»åŠ¡")]),_:1}),n(x,{class:"empty-hint"},{default:a(()=>[_("ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ æ–°ä»»åŠ¡")]),_:1})]),_:1})):u("",!0),(r(!0),p(y,null,C(o.filteredTasks,e=>(r(),t(S,{class:"task-card",key:e.id},{default:a(()=>[n(S,{class:"card-header"},{default:a(()=>[n(S,{class:"task-info"},{default:a(()=>[n(x,{class:"task-icon"},{default:a(()=>[_(m(d.getCategoryIcon(e.category)),1)]),_:2},1024),n(S,{class:"task-details"},{default:a(()=>[n(x,{class:"task-title"},{default:a(()=>[_(m(e.title),1)]),_:2},1024),e.assigned_to?(r(),t(x,{key:0,class:"task-assigned"},{default:a(()=>[_(" åˆ†é…ç»™ï¼š"+m(e.assigned_to),1)]),_:2},1024)):u("",!0)]),_:2},1024)]),_:2},1024),n(S,{class:h(["status-badge","completed"===e.status?"status-completed":"status-pending"])},{default:a(()=>[_(m("completed"===e.status?"å·²å®Œæˆ":"å¾…å®Œæˆ"),1)]),_:2},1032,["class"])]),_:2},1024),e.description?(r(),t(S,{key:0,class:"task-description"},{default:a(()=>[n(x,null,{default:a(()=>[_(m(e.description),1)]),_:2},1024)]),_:2},1024)):u("",!0),n(S,{class:"card-footer"},{default:a(()=>[n(S,{class:"task-meta"},{default:a(()=>[n(x,{class:"meta-icon"},{default:a(()=>[_("ğŸ’–")]),_:1}),n(x,{class:"meta-text"},{default:a(()=>[_("+"+m(e.points)+" æƒ…åŠ›",1)]),_:2},1024)]),_:2},1024),e.due_date?(r(),t(S,{key:0,class:"task-meta"},{default:a(()=>[n(x,{class:"meta-icon"},{default:a(()=>[_("â°")]),_:1}),n(x,{class:"meta-text"},{default:a(()=>[_(m(d.formatDate(e.due_date)),1)]),_:2},1024)]),_:2},1024)):u("",!0),n(S,{class:"task-meta"},{default:a(()=>[n(x,{class:"meta-icon"},{default:a(()=>[_("ğŸ“‚")]),_:1}),n(x,{class:"meta-text"},{default:a(()=>[_(m(d.getCategoryName(e.category)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),n(S,{class:"card-actions"},{default:a(()=>["pending"===e.status?(r(),t(M,{key:0,class:"btn-complete",onClick:t=>d.completeTask(e)},{default:a(()=>[_(" å®Œæˆä»»åŠ¡ ")]),_:2},1032,["onClick"])):u("",!0),n(M,{class:"btn-edit",onClick:t=>d.editTask(e)},{default:a(()=>[_(" ç¼–è¾‘ ")]),_:2},1032,["onClick"]),n(M,{class:"btn-delete",onClick:t=>d.deleteTask(e)},{default:a(()=>[_(" åˆ é™¤ ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["style"]),n(S,{class:"add-btn",onClick:d.showAddModal},{default:a(()=>[n(x,{class:"add-icon"},{default:a(()=>[_("+")]),_:1})]),_:1},8,["onClick"]),o.showModal?(r(),t(S,{key:0,class:"modal-overlay",onClick:d.closeModal},{default:a(()=>[n(S,{class:"modal-content",onClick:s[7]||(s[7]=b(()=>{},["stop"]))},{default:a(()=>[n(S,{class:"modal-header"},{default:a(()=>[n(x,{class:"modal-title"},{default:a(()=>[_(m(o.isEdit?"ç¼–è¾‘ä»»åŠ¡":"æ–°å»ºä»»åŠ¡"),1)]),_:1}),n(x,{class:"modal-close",onClick:d.closeModal},{default:a(()=>[_("âœ•")]),_:1},8,["onClick"])]),_:1}),n(S,{class:"modal-body"},{default:a(()=>[n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("ä»»åŠ¡åç§°")]),_:1}),n(F,{class:"form-input",modelValue:o.formData.title,"onUpdate:modelValue":s[3]||(s[3]=t=>o.formData.title=t),placeholder:"è¯·è¾“å…¥ä»»åŠ¡åç§°",maxlength:"50"},null,8,["modelValue"])]),_:1}),n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("ä»»åŠ¡æè¿°")]),_:1}),n(V,{class:"form-textarea",modelValue:o.formData.description,"onUpdate:modelValue":s[4]||(s[4]=t=>o.formData.description=t),placeholder:"è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹ï¼ˆå¯é€‰ï¼‰",maxlength:"200"},null,8,["modelValue"])]),_:1}),n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("ä»»åŠ¡åˆ†ç±»")]),_:1}),n(P,{mode:"selector",range:o.categories,"range-key":"label",onChange:d.onCategoryChange},{default:a(()=>[n(S,{class:"picker-view"},{default:a(()=>[n(x,null,{default:a(()=>[_(m(o.selectedCategory.label),1)]),_:1}),n(x,{class:"picker-arrow"},{default:a(()=>[_("â–¼")]),_:1})]),_:1})]),_:1},8,["range","onChange"])]),_:1}),n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("åˆ†é…ç»™")]),_:1}),n(F,{class:"form-input",modelValue:o.formData.assigned_to,"onUpdate:modelValue":s[5]||(s[5]=t=>o.formData.assigned_to=t),placeholder:"è¾“å…¥ä¼´ä¾£åç§°ï¼ˆå¯é€‰ï¼‰",maxlength:"20"},null,8,["modelValue"])]),_:1}),n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("æˆªæ­¢æ—¥æœŸ")]),_:1}),n(P,{mode:"date",value:o.formData.due_date,onChange:d.onDateChange},{default:a(()=>[n(S,{class:"picker-view"},{default:a(()=>[n(x,null,{default:a(()=>[_(m(o.formData.due_date||"é€‰æ‹©æ—¥æœŸ"),1)]),_:1}),n(x,{class:"picker-arrow"},{default:a(()=>[_("â–¼")]),_:1})]),_:1})]),_:1},8,["value","onChange"])]),_:1}),n(S,{class:"form-group"},{default:a(()=>[n(x,{class:"form-label"},{default:a(()=>[_("å¥–åŠ±æƒ…åŠ›")]),_:1}),n(F,{class:"form-input",modelValue:o.formData.points,"onUpdate:modelValue":s[6]||(s[6]=t=>o.formData.points=t),type:"number",placeholder:"é»˜è®¤10ç‚¹"},null,8,["modelValue"])]),_:1})]),_:1}),n(S,{class:"modal-footer"},{default:a(()=>[n(M,{class:"btn-cancel",onClick:d.closeModal},{default:a(()=>[_("å–æ¶ˆ")]),_:1},8,["onClick"]),n(M,{class:"btn-confirm",onClick:d.handleSubmit},{default:a(()=>[_(m(o.isEdit?"ä¿å­˜":"åˆ›å»º"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):u("",!0)]),_:1})}],["__scopeId","data-v-04c8c0d7"]]);export{U as default};
