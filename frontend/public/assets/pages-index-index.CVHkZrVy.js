import{c as t,w as s,s as a,a as e,r as l,b as c,h as o,d as n,n as i,i as u,o as d,e as r,f,g as _,j as k,t as g,k as m,S as h,l as p,F as C,m as T,p as w,q as y,u as x}from"./index-Cg44Emc2.js";import{_ as S,s as b,a as v}from"./_plugin-vue_export-helper.BNHJzMf4.js";const D=S({data:()=>({userName:"æ¸¸å®¢",userPoints:0,taskStats:{total:0,completed:0,pending:0},unlockedFruits:0,recentTasks:[],showLogoutConfirm:!1}),onLoad(){this.checkLogin()},onShow(){b.isLoggedIn()&&(this.loadUserData(),this.loadTaskStats(),this.loadRecentTasks(),this.loadFruitsCount())},methods:{checkLogin(){const t=b.getUser();t?this.userName=t.username||"ç”¨æˆ·":n({title:"æç¤º",content:"è¯·å…ˆç™»å½•",showCancel:!1,success:()=>{i({url:"/pages/login/index"})}})},async loadUserData(){try{const t=b.getUser();if(!t)return;this.userName=t.username||"ç”¨æˆ·";const s=await v.getPoints(t.user_id);s.success&&(this.userPoints=s.data.points||0,b.updatePoints(this.userPoints))}catch(t){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",t)}},async loadTaskStats(){try{const t=b.getUser();if(!t)return;const s=await v.getTaskStats(t.user_id);s.success&&(this.taskStats=s.data)}catch(t){console.error("åŠ è½½ä»»åŠ¡ç»Ÿè®¡å¤±è´¥:",t)}},async loadRecentTasks(){try{const t=b.getUser();if(!t)return;const s=await v.getTasks(t.user_id);s.success&&(this.recentTasks=(s.data||[]).slice(0,5))}catch(t){console.error("åŠ è½½è¿‘æœŸä»»åŠ¡å¤±è´¥:",t)}},async loadFruitsCount(){try{const t=b.getUser();if(!t)return;const s=await v.getFruits(t.user_id);if(s.success){const t=s.data||[];this.unlockedFruits=t.filter(t=>t.unlocked).length}}catch(t){console.error("åŠ è½½æžœå®žæ•°é‡å¤±è´¥:",t)}},getCategoryIcon:t=>({general:"ðŸ“",housework:"ðŸ§¹",date:"ðŸ’‘",study:"ðŸ“š",exercise:"ðŸƒ"}[t]||"ðŸ“"),formatDate(t){if(!t)return"";const s=new Date(t),a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate()),l=new Date(s.getFullYear(),s.getMonth(),s.getDate()),c=Math.floor((l-e)/864e5);if(0===c)return"ä»Šå¤©";if(1===c)return"æ˜Žå¤©";if(-1===c)return"æ˜¨å¤©";return`${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},viewTaskDetail(t){n({title:t.title,content:t.description||"æš‚æ— æè¿°",confirmText:"pending"===t.status?"å®Œæˆä»»åŠ¡":"ç¡®å®š",showCancel:"pending"===t.status,success:s=>{s.confirm&&"pending"===t.status&&this.completeTask(t)}})},async completeTask(t){try{const s=b.getUser();if(!s)return;c({title:"å¤„ç†ä¸­...",mask:!0});(await v.completeTask(s.user_id,t.id)).success&&(e({title:`èŽ·å¾—${t.points}ç‚¹æƒ…åŠ›`,icon:"success",duration:2e3}),this.loadUserData(),this.loadTaskStats(),this.loadRecentTasks())}catch(s){console.error("å®Œæˆä»»åŠ¡å¤±è´¥:",s)}finally{o()}},handleUserClick(){this.showLogoutConfirm=!0},closeLogout(){this.showLogoutConfirm=!1},confirmLogout(){b.clear(),e({title:"å·²é€€å‡ºç™»å½•",icon:"success",duration:1500}),setTimeout(()=>{l({url:"/pages/login/index"})},1500)},goToTask(){a({url:"/pages/task/index"})},goToHousework(){a({url:"/pages/housework/index"})},goToSchedule(){a({url:"/pages/schedule/index"})},goToTree(){a({url:"/pages/tree/index"})}}},[["render",function(a,e,l,c,o,n){const i=_,S=u,b=m,v=h,D=x;return d(),t(S,{class:"index-container"},{default:s(()=>[r(S,{class:"header-section"},{default:s(()=>[r(S,{class:"welcome-box"},{default:s(()=>[r(i,{class:"welcome-text"},{default:s(()=>[k("ðŸ’• æ‹äººå¤æƒ…æ ‘ ðŸ’•")]),_:1}),r(i,{class:"welcome-subtitle"},{default:s(()=>[k("æ„¿ä½ ä»¬çš„çˆ±æƒ…ä¹‹æ ‘èŒå£®æˆé•¿")]),_:1})]),_:1}),r(S,{class:"user-info",onClick:n.handleUserClick},{default:s(()=>[r(S,{class:"avatar"},{default:s(()=>[r(i,{class:"avatar-icon"},{default:s(()=>[k("ðŸ‘¤")]),_:1})]),_:1}),r(S,{class:"user-details"},{default:s(()=>[r(i,{class:"username"},{default:s(()=>[k(g(o.userName),1)]),_:1}),r(S,{class:"points-row"},{default:s(()=>[r(i,{class:"points-icon"},{default:s(()=>[k("ðŸ’–")]),_:1}),r(i,{class:"points-value"},{default:s(()=>[k(g(o.userPoints),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1}),r(S,{class:"tree-preview-section",onClick:n.goToTree},{default:s(()=>[r(S,{class:"tree-bg"},{default:s(()=>[r(b,{class:"tree-image",src:"https://hpi-hub.tos-cn-beijing.volces.com/static/biology/tree-8378346_1280.png",mode:"aspectFit"}),r(S,{class:"tree-overlay"},{default:s(()=>[r(i,{class:"tree-title"},{default:s(()=>[k("ðŸŒ³ æŸ¥çœ‹å¤æƒ…æ ‘")]),_:1}),r(i,{class:"tree-hint"},{default:s(()=>[k("ç‚¹å‡»æŸ¥çœ‹æ‚¨çš„æžœå®žæ”¶èŽ·")]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"]),r(S,{class:"stats-grid"},{default:s(()=>[r(S,{class:"stat-item"},{default:s(()=>[r(i,{class:"stat-icon"},{default:s(()=>[k("ðŸ“‹")]),_:1}),r(i,{class:"stat-value"},{default:s(()=>[k(g(o.taskStats.total),1)]),_:1}),r(i,{class:"stat-label"},{default:s(()=>[k("æ€»ä»»åŠ¡")]),_:1})]),_:1}),r(S,{class:"stat-item"},{default:s(()=>[r(i,{class:"stat-icon"},{default:s(()=>[k("âœ…")]),_:1}),r(i,{class:"stat-value"},{default:s(()=>[k(g(o.taskStats.completed),1)]),_:1}),r(i,{class:"stat-label"},{default:s(()=>[k("å·²å®Œæˆ")]),_:1})]),_:1}),r(S,{class:"stat-item"},{default:s(()=>[r(i,{class:"stat-icon"},{default:s(()=>[k("â³")]),_:1}),r(i,{class:"stat-value"},{default:s(()=>[k(g(o.taskStats.pending),1)]),_:1}),r(i,{class:"stat-label"},{default:s(()=>[k("å¾…å®Œæˆ")]),_:1})]),_:1}),r(S,{class:"stat-item"},{default:s(()=>[r(i,{class:"stat-icon"},{default:s(()=>[k("ðŸŽ")]),_:1}),r(i,{class:"stat-value"},{default:s(()=>[k(g(o.unlockedFruits),1)]),_:1}),r(i,{class:"stat-label"},{default:s(()=>[k("å·²è§£é”æžœå®ž")]),_:1})]),_:1})]),_:1}),r(S,{class:"quick-actions"},{default:s(()=>[r(S,{class:"section-title"},{default:s(()=>[r(i,{class:"title-icon"},{default:s(()=>[k("âš¡")]),_:1}),r(i,{class:"title-text"},{default:s(()=>[k("å¿«æ·å…¥å£")]),_:1})]),_:1}),r(S,{class:"actions-grid"},{default:s(()=>[r(S,{class:"action-card",onClick:n.goToTask},{default:s(()=>[r(i,{class:"action-icon"},{default:s(()=>[k("ðŸ“")]),_:1}),r(i,{class:"action-name"},{default:s(()=>[k("ä»»åŠ¡åˆ—è¡¨")]),_:1})]),_:1},8,["onClick"]),r(S,{class:"action-card",onClick:n.goToHousework},{default:s(()=>[r(i,{class:"action-icon"},{default:s(()=>[k("ðŸ§¹")]),_:1}),r(i,{class:"action-name"},{default:s(()=>[k("å®¶åŠ¡å®‰æŽ’")]),_:1})]),_:1},8,["onClick"]),r(S,{class:"action-card",onClick:n.goToSchedule},{default:s(()=>[r(i,{class:"action-icon"},{default:s(()=>[k("ðŸ“…")]),_:1}),r(i,{class:"action-name"},{default:s(()=>[k("æ—¶é—´å®‰æŽ’")]),_:1})]),_:1},8,["onClick"]),r(S,{class:"action-card",onClick:n.goToTree},{default:s(()=>[r(i,{class:"action-icon"},{default:s(()=>[k("ðŸŒ³")]),_:1}),r(i,{class:"action-name"},{default:s(()=>[k("å¤æƒ…æ ‘")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),r(S,{class:"recent-tasks"},{default:s(()=>[r(S,{class:"section-title"},{default:s(()=>[r(i,{class:"title-icon"},{default:s(()=>[k("ðŸ“Œ")]),_:1}),r(i,{class:"title-text"},{default:s(()=>[k("è¿‘æœŸä»»åŠ¡")]),_:1}),r(i,{class:"more-link",onClick:n.goToTask},{default:s(()=>[k("æŸ¥çœ‹å…¨éƒ¨ â†’")]),_:1},8,["onClick"])]),_:1}),r(v,{class:"tasks-scroll","scroll-y":""},{default:s(()=>[0===o.recentTasks.length?(d(),t(S,{key:0,class:"empty-tasks"},{default:s(()=>[r(i,{class:"empty-icon"},{default:s(()=>[k("ðŸ“­")]),_:1}),r(i,{class:"empty-text"},{default:s(()=>[k("æš‚æ— è¿‘æœŸä»»åŠ¡")]),_:1})]),_:1})):f("",!0),(d(!0),p(C,null,T(o.recentTasks,a=>(d(),t(S,{class:"task-item",key:a.id,onClick:t=>n.viewTaskDetail(a)},{default:s(()=>[r(S,{class:"task-left"},{default:s(()=>[r(i,{class:"task-category-icon"},{default:s(()=>[k(g(n.getCategoryIcon(a.category)),1)]),_:2},1024),r(S,{class:"task-content"},{default:s(()=>[r(i,{class:"task-title"},{default:s(()=>[k(g(a.title),1)]),_:2},1024),r(S,{class:"task-meta-row"},{default:s(()=>[a.due_date?(d(),t(S,{key:0,class:"meta-item"},{default:s(()=>[r(i,{class:"meta-icon"},{default:s(()=>[k("â°")]),_:1}),r(i,{class:"meta-text"},{default:s(()=>[k(g(n.formatDate(a.due_date)),1)]),_:2},1024)]),_:2},1024)):f("",!0),r(S,{class:"meta-item"},{default:s(()=>[r(i,{class:"meta-icon"},{default:s(()=>[k("ðŸ’–")]),_:1}),r(i,{class:"meta-text"},{default:s(()=>[k("+"+g(a.points),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),r(S,{class:w(["task-status","completed"===a.status?"status-completed":"status-pending"])},{default:s(()=>[k(g("completed"===a.status?"âœ“":"â—‹"),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),o.showLogoutConfirm?(d(),t(S,{key:0,class:"modal-overlay",onClick:n.closeLogout},{default:s(()=>[r(S,{class:"modal-content",onClick:e[0]||(e[0]=y(()=>{},["stop"]))},{default:s(()=>[r(S,{class:"modal-header"},{default:s(()=>[r(i,{class:"modal-title"},{default:s(()=>[k("é€€å‡ºç™»å½•")]),_:1}),r(i,{class:"modal-close",onClick:n.closeLogout},{default:s(()=>[k("âœ•")]),_:1},8,["onClick"])]),_:1}),r(S,{class:"modal-body"},{default:s(()=>[r(i,{class:"modal-text"},{default:s(()=>[k("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")]),_:1})]),_:1}),r(S,{class:"modal-footer"},{default:s(()=>[r(D,{class:"btn-cancel",onClick:n.closeLogout},{default:s(()=>[k("å–æ¶ˆ")]),_:1},8,["onClick"]),r(D,{class:"btn-confirm",onClick:n.confirmLogout},{default:s(()=>[k("ç¡®å®š")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):f("",!0)]),_:1})}],["__scopeId","data-v-be8e9c59"]]);export{D as default};
